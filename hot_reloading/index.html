<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="https://mff-uk.github.io/sparqless/hot_reloading/" rel="canonical"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Hot Reloading - SPARQLess</title>
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "Hot Reloading";
        var mkdocs_page_input_path = "hot_reloading.md";
        var mkdocs_page_url = "/sparqless/hot_reloading/";
      </script>
<script defer="" src="../js/jquery-3.6.0.min.js"></script>
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<link href="../pdf/documentation.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> SPARQLess
        </a>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<ul>
<li class="toctree-l1"><a class="reference internal" href="..">Home</a>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docker/">Docker</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/">Usage</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
</li>
</ul>
<p class="caption"><span class="caption-text">How it works</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../observation/">Observation</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../model_parsing/">Parsing</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../postprocessing/">Postprocessing</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../schema/">Schema Creation</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../querying/">Querying</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../model_checkpointing/">Model Checkpointing</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="./">Hot Reloading</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/">Development</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../editing_documentation/">Editing documentation</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">SPARQLess</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a alt="Docs" class="icon icon-home" href=".."></a> »</li>
<li>How it works »</li><li>Hot Reloading</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/mff-uk/sparqless/edit/master/docs/hot_reloading.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="hot-reloading">Hot reloading</h1>
<p>Hot reloading of the GraphQL schema means updating the running GraphQL
server's schema while it is already running. The reason for why you
may want to do this is that observing very large datasets can take
a very long time, and users may not want to wait for 2 hours
before they can even look at the schema or query the endpoint.</p>
<p>Therefore, only the required observations for actually building
a schema are performed at startup when using hot reloading.
More in-depth observations (i.e. accurate property counts)
are then performed in the background, once the server is already
running, and the user is able to query it.</p>
<p>The schema is then seamlessly updated, and if the user is using
the default playground which is started with SPARQLess,
they don't even need to refresh their browser window to see
the new schema - it refreshes itself automatically.</p>
<p>In the following diagram, you can see how the GraphQL
schema continues to be updated in the background while
the user is free to explore and query the endpoint:</p>
<p><img alt="hot reloading diagram" src="../img/hot_reloading_diagram.png"/></p>
<h2 id="how-it-works">How it works</h2>
<p>After the server starts, the <code>hotReloadServerSchema</code> function of the
<code>SPARQLess</code> class can be used to run hot reloading. Firstly,
hot reloading must be configured in the <code>Config</code>. It is enabled
by default, and the default configuration looks like this:</p>
<pre><code class="language-ts">hotReload: {
    configIterator: (config, _oldModel) =&gt; {
        // Examine 10 times more properties than in the last iteration.

        const newConfig = cloneDeep(config);

        if (newConfig.maxPropertyCount) {
            newConfig.maxPropertyCount *= 10;
        }
        return newConfig;
    },
    shouldIterate: (_config, oldModel, newModel) =&gt; {
        // Check if the maximum property count changed in the last iteration.
        // If not, then there is no point in continuing to count them, since
        // we already have everything counted.

        const getMaxPropertyCount = (model: ClassDescriptor[]) =&gt;
            Math.max(
                ...model
                    .flatMap((x) =&gt; [...x.attributes, ...x.associations])
                    .map((x) =&gt; x.count),
            );

        const maxPropertyCountOld = getMaxPropertyCount(oldModel);
        const maxPropertyCountNew = getMaxPropertyCount(newModel);

        if (maxPropertyCountOld === maxPropertyCountNew) {
            return false;
        }

        return true;
    },
},
</code></pre>
<p>The hot reload algorithm can be described as the following:</p>
<ol>
<li>
<p>Get a new <code>ObservationConfig</code> for the next round of observations.
This config is obtained using the <code>configIterator</code> function
from the hot reload configuration.</p>
</li>
<li>
<p>Conduct a new round of observations, which are more detailed
and likely take more time than the previous round.
The default behavior is to count up to 10 times as many property
instances than the previous round of observation.</p>
</li>
<li>
<p>Hot-reload the running GraphQL endpoint's schema</p>
</li>
<li>
<p>Poll the <code>shouldIterate</code> function from the hot reload configuration
about whether or not the hot reloading should keep iterating.
If it returns <code>true</code>, the algorithm loops. If <code>false</code>, hot reloading
stops for good.</p>
</li>
</ol>
</div>
</div><footer>
<div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-left" href="../model_checkpointing/" title="Model Checkpointing"><span class="icon icon-circle-arrow-left"></span> Previous</a>
<a class="btn btn-neutral float-right" href="../development/" title="Development">Next <span class="icon icon-circle-arrow-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span>
<a class="fa fa-github" href="https://github.com/mff-uk/sparqless" style="color: #fcfcfc"> GitHub</a>
</span>
<span><a href="../model_checkpointing/" style="color: #fcfcfc">« Previous</a></span>
<span><a href="../development/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script>var base_url = '..';</script>
<script defer="" src="../js/theme_extra.js"></script>
<script defer="" src="../js/theme.js"></script>
<script defer="">
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>
</body>
</html>
